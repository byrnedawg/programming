{"changed":true,"filter":false,"title":"dk.c","tooltip":"/avr/notes/beginC/dk.c","value":"/*\n * DigitalDice_SingleDigit.c\n * Written in AVR Studio 5\n * Compiler: AVR GNU C Compiler (GCC)\n *\n * Created: 5/27/2011 10:50:48 PM\n * Author: AVR Tutorials\n * Website: www.AVR-Tutorials.com\n *\n * Description: AVR C program for ATMega16 Seven Segment \n * Single Digit Digital Dice Project\n */ \n \n#define DicePort\t\tPORTA\n#define DicePortDDR\t\tDDRA\n \n#define SwitchPortDDR\t\tDDRD\n#define SwitchPort\t\tPORTD\n#define SwitchPin\t\tPIND\n \n#define RollSwitch\t\t7\n \n#define F_CPU\t\t\t4000000UL\n \n#include <avr/io.h>\n#include <stdlib.h>\n#include <util/delay.h>\n#include <avr/interrupt.h>\n \nunsigned char seed = 0;\n \n/*Declaration of functions. The implementation of these */\n/*function are done below the main() function*/\nunsigned char digit_to_7segval(unsigned char digit);\nvoid roll_dice(unsigned char times);\nvoid init();\nISR(TIMER0_OVF_vect);\n \n \nint main(void)\n{\t\n\tunsigned char digit = 0;\n \n\tinit();\t// Configure the Microcontroller\n \n    /*Do forever*/\n\twhile(1)\n\t{\n \n\t\tif(!(SwitchPin & (1<<RollSwitch)))\n\t\t{\n\t\t\t/*Roll the dice 2 times*/\n\t\t\troll_dice(2);\n \n\t\t\t/*Generate an integer based random number between */\n\t\t\t/*1 and 6 inclusive and store it in digit*/\n\t\t\tseed = (seed*17)+21;\n\t\t\tdigit = seed % 6;\n\t\t\tdigit++;\n \n\t\t\t/*Get the Seven Segment value of the random number*/\n\t\t\t/*and output it to the pins of port B*/\t\n\t\t\tDicePort = digit_to_7segval(digit); \n\t\t}\t\t\t\n\t}\t\t\n \n}\n \n/*Configuration for the microcontroller*/\nvoid init()\n{\n\t/*Configure DicePort as an output port*/\n\tDicePortDDR = 0xFF;\n \n\t/*Configure SwitchPort as an input port*/\n\tSwitchPortDDR = 0x00;\n\t/*Enable SwitchPort pull-up resistors*/\n\tSwitchPort = 0xFF;\n \n\tTCCR0 = 0x01;   // Enable Timer0 with no prescalar\n\tTIMSK = 0x01;   // Enable Timer0 interrupt\n\tsei();\t\t\t// Enable Global Interrupt\n}\t\n \n/*This function takes an character value and return the */\n/*and return the value to be outputted to display that */\n/*character on a seven segment display*/\nunsigned char digit_to_7segval(unsigned char digit)\n{\n\tunsigned char segval = '0';\n \n\tif(digit == 1)\n\t\tsegval = 0x06;\t\t// 7-Seg Value for Digit 1\n\telse if (digit == 2)\n\t\tsegval = 0x5B;\t\t// 7-Seg Value for Digit 2\n\telse if (digit == 3)\n\t\tsegval = 0x4F;\t\t// 7-Seg Value for Digit 3\n\telse if (digit == 4)\n\t\tsegval = 0x66;\t\t// 7-Seg Value for Digit 4\n\telse if (digit == 5)\n\t\tsegval = 0x6D;\t\t// 7-Seg Value for Digit 5\n\telse if (digit == 6)\n\t\tsegval = 0x7D;\t\t// 7-Seg Value for Digit 6\n \n\treturn segval;\n}\n \n/*This function simulates the rolling of the dice*/\nvoid roll_dice(unsigned char times)\n{\n\tunsigned char i;\n \n\tfor(i=0; i<times; i++)\n\t{\n\t\tDicePort = 0x06;\t// Display #1 on dice\n\t\t_delay_ms(100);\n\t\tDicePort = 0x5B;\t// Display #2 on dice\n\t\t_delay_ms(100);\n\t\tDicePort = 0x4F;\t// Display #3 on dice\n\t\t_delay_ms(100);\n\t\tDicePort = 0x66;\t// Display #4 on dice\n\t\t_delay_ms(100);\n\t\tDicePort = 0x6D;\t// Display #5 on dice\n\t\t_delay_ms(100);\n\t\tDicePort = 0x7D;\t// Display #6 on dice\n\t\t_delay_ms(100);\n \n\t}\t\t\n}\n \n/*Interrupt Service Routine for timer overflow*/\nISR(TIMER0_OVF_vect)\n{\n\tseed++; // Increment the value in the variable seed\n}\t\t","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":134,"column":3},"action":"insert","lines":["/*"," * DigitalDice_SingleDigit.c"," * Written in AVR Studio 5"," * Compiler: AVR GNU C Compiler (GCC)"," *"," * Created: 5/27/2011 10:50:48 PM"," * Author: AVR Tutorials"," * Website: www.AVR-Tutorials.com"," *"," * Description: AVR C program for ATMega16 Seven Segment "," * Single Digit Digital Dice Project"," */ "," ","#define DicePort\t\tPORTA","#define DicePortDDR\t\tDDRA"," ","#define SwitchPortDDR\t\tDDRD","#define SwitchPort\t\tPORTD","#define SwitchPin\t\tPIND"," ","#define RollSwitch\t\t7"," ","#define F_CPU\t\t\t4000000UL"," ","#include <avr/io.h>","#include <stdlib.h>","#include <util/delay.h>","#include <avr/interrupt.h>"," ","unsigned char seed = 0;"," ","/*Declaration of functions. The implementation of these */","/*function are done below the main() function*/","unsigned char digit_to_7segval(unsigned char digit);","void roll_dice(unsigned char times);","void init();","ISR(TIMER0_OVF_vect);"," "," ","int main(void)","{\t","\tunsigned char digit = 0;"," ","\tinit();\t// Configure the Microcontroller"," ","    /*Do forever*/","\twhile(1)","\t{"," ","\t\tif(!(SwitchPin & (1<<RollSwitch)))","\t\t{","\t\t\t/*Roll the dice 2 times*/","\t\t\troll_dice(2);"," ","\t\t\t/*Generate an integer based random number between */","\t\t\t/*1 and 6 inclusive and store it in digit*/","\t\t\tseed = (seed*17)+21;","\t\t\tdigit = seed % 6;","\t\t\tdigit++;"," ","\t\t\t/*Get the Seven Segment value of the random number*/","\t\t\t/*and output it to the pins of port B*/\t","\t\t\tDicePort = digit_to_7segval(digit); ","\t\t}\t\t\t","\t}\t\t"," ","}"," ","/*Configuration for the microcontroller*/","void init()","{","\t/*Configure DicePort as an output port*/","\tDicePortDDR = 0xFF;"," ","\t/*Configure SwitchPort as an input port*/","\tSwitchPortDDR = 0x00;","\t/*Enable SwitchPort pull-up resistors*/","\tSwitchPort = 0xFF;"," ","\tTCCR0 = 0x01;   // Enable Timer0 with no prescalar","\tTIMSK = 0x01;   // Enable Timer0 interrupt","\tsei();\t\t\t// Enable Global Interrupt","}\t"," ","/*This function takes an character value and return the */","/*and return the value to be outputted to display that */","/*character on a seven segment display*/","unsigned char digit_to_7segval(unsigned char digit)","{","\tunsigned char segval = '0';"," ","\tif(digit == 1)","\t\tsegval = 0x06;\t\t// 7-Seg Value for Digit 1","\telse if (digit == 2)","\t\tsegval = 0x5B;\t\t// 7-Seg Value for Digit 2","\telse if (digit == 3)","\t\tsegval = 0x4F;\t\t// 7-Seg Value for Digit 3","\telse if (digit == 4)","\t\tsegval = 0x66;\t\t// 7-Seg Value for Digit 4","\telse if (digit == 5)","\t\tsegval = 0x6D;\t\t// 7-Seg Value for Digit 5","\telse if (digit == 6)","\t\tsegval = 0x7D;\t\t// 7-Seg Value for Digit 6"," ","\treturn segval;","}"," ","/*This function simulates the rolling of the dice*/","void roll_dice(unsigned char times)","{","\tunsigned char i;"," ","\tfor(i=0; i<times; i++)","\t{","\t\tDicePort = 0x06;\t// Display #1 on dice","\t\t_delay_ms(100);","\t\tDicePort = 0x5B;\t// Display #2 on dice","\t\t_delay_ms(100);","\t\tDicePort = 0x4F;\t// Display #3 on dice","\t\t_delay_ms(100);","\t\tDicePort = 0x66;\t// Display #4 on dice","\t\t_delay_ms(100);","\t\tDicePort = 0x6D;\t// Display #5 on dice","\t\t_delay_ms(100);","\t\tDicePort = 0x7D;\t// Display #6 on dice","\t\t_delay_ms(100);"," ","\t}\t\t","}"," ","/*Interrupt Service Routine for timer overflow*/","ISR(TIMER0_OVF_vect)","{","\tseed++; // Increment the value in the variable seed","}\t\t"],"id":1}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":3},"end":{"row":1,"column":26},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1475103056135}